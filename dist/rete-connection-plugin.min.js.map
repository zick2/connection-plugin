{"version":3,"file":"rete-connection-plugin.min.js","sources":["src/pseudoconnection.ts","src/utils.ts","src/flow/base.ts","src/flow/utils.ts","src/flow/builtin/bidirect.ts","src/flow/builtin/classic/sync-connections.ts","src/flow/builtin/classic/index.ts","src/presets/classic.ts","src/index.ts"],"sourcesContent":["import { getUID } from 'rete'\r\nimport { BaseArea, BaseAreaPlugin } from 'rete-area-plugin'\r\n\r\nimport { ClassicScheme, Position, SocketData } from './types'\r\n\r\n/**\r\n * Create pseudoconnection. Used to trigger rendering of connection that is being created by user.\r\n * Has additional `isPseudo` property in payload.\r\n * @param extra Extra payload to add to connection\r\n */\r\nexport function createPseudoconnection<Schemes extends ClassicScheme, K>(extra?: Partial<Schemes['Connection']>) {\r\n  let element: HTMLElement | null = null\r\n  let id: string | null = null\r\n\r\n  function unmount(areaPlugin: BaseAreaPlugin<Schemes, BaseArea<Schemes> | K>) {\r\n    if (id) {\r\n      areaPlugin.removeConnectionView(id)\r\n    }\r\n    element = null\r\n    id = null\r\n  }\r\n  function mount(areaPlugin: BaseAreaPlugin<Schemes, BaseArea<Schemes> | K>) {\r\n    unmount(areaPlugin)\r\n    id = `pseudo_${getUID()}`\r\n  }\r\n\r\n  return {\r\n    isMounted() {\r\n      return Boolean(id)\r\n    },\r\n    mount,\r\n    render(areaPlugin: BaseAreaPlugin<Schemes, BaseArea<Schemes> | K>, { x, y }: Position, data: SocketData) {\r\n      const isOutput = data.side === 'output'\r\n      const pointer = {\r\n        x: x + (isOutput\r\n          ? -3\r\n          : 3),\r\n        y\r\n      } // fix hover of underlying elements\r\n\r\n      if (!id) throw new Error('pseudo connection id wasn\\'t generated')\r\n\r\n      const payload = isOutput\r\n        ? {\r\n          id,\r\n          source: data.nodeId,\r\n          sourceOutput: data.key,\r\n          target: '',\r\n          targetInput: '',\r\n          ...extra ?? {}\r\n        }\r\n        : {\r\n          id,\r\n          target: data.nodeId,\r\n          targetInput: data.key,\r\n          source: '',\r\n          sourceOutput: '',\r\n          ...extra ?? {}\r\n        }\r\n\r\n      if (!element) {\r\n        const view = areaPlugin.addConnectionView(payload)\r\n\r\n        element = view.element\r\n      }\r\n\r\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\r\n      if (!element) return\r\n\r\n      void areaPlugin.emit({\r\n        type: 'render',\r\n        data: {\r\n          element,\r\n          type: 'connection',\r\n          payload,\r\n          ...isOutput\r\n            ? { end: pointer }\r\n            : { start: pointer }\r\n        }\r\n      })\r\n    },\r\n    unmount\r\n  }\r\n}\r\n","import { SocketData } from './types'\r\n/**\r\n * @param elements list of Element returned by document.elementsFromPoint\r\n */\r\nexport function findSocket(socketsCache: WeakMap<Element, SocketData>, elements: Element[]) {\r\n  for (const element of elements) {\r\n    const found = socketsCache.get(element)\r\n\r\n    if (found) {\r\n      return found\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Alternative to document.elementsFromPoint that traverses shadow roots\r\n * @param x x coordinate\r\n * @param y y coordinate\r\n * @param root root element to search in\r\n */\r\nexport function elementsFromPoint(x: number, y: number, root: ShadowRoot | Document = document) {\r\n  const elements = root.elementsFromPoint(x, y)\r\n  const shadowRoot = elements[0]?.shadowRoot\r\n\r\n  if (shadowRoot && shadowRoot !== root) {\r\n    elements.unshift(...elementsFromPoint(x, y, shadowRoot))\r\n  }\r\n\r\n  return elements\r\n}\r\n","import { BaseSchemes, NodeEditor, Scope } from 'rete'\r\n\r\nimport { Connection, SocketData } from '../types'\r\n\r\nexport type Context<Schemes extends BaseSchemes, K extends any[]> = {\r\n  editor: NodeEditor<Schemes>\r\n  scope: Scope<Connection, K>\r\n  socketsCache: Map<Element, SocketData>\r\n}\r\nexport type EventType = 'up' | 'down'\r\nexport type PickParams = { socket: SocketData, event: EventType }\r\n\r\nexport abstract class Flow<Schemes extends BaseSchemes, K extends any[]> {\r\n  public abstract pick(params: PickParams, context: Context<Schemes, K>): Promise<void>\r\n  public abstract getPickedSocket(): SocketData | undefined\r\n  public abstract drop(context: Context<Schemes, K>): void\r\n}\r\n","import { getUID } from 'rete'\r\n\r\nimport { ClassicScheme, SocketData } from '../types'\r\nimport { Context, PickParams } from './base'\r\n\r\nexport interface StateContext<Schemes extends ClassicScheme, K extends any[]> {\r\n  currentState: State<Schemes, K>\r\n  switchTo(state: State<Schemes, K>): void\r\n}\r\n\r\nexport abstract class State<Schemes extends ClassicScheme, K extends any[]> {\r\n  context!: StateContext<Schemes, K>\r\n  initial: SocketData | undefined\r\n\r\n  setContext(context: StateContext<Schemes, K>) {\r\n    this.context = context\r\n  }\r\n\r\n  abstract pick(params: PickParams, context: Context<Schemes, K>): Promise<void>\r\n  abstract drop(context: Context<Schemes, K>): void\r\n}\r\n\r\nexport function getSourceTarget(initial: SocketData, socket: SocketData) {\r\n  const forward = initial.side === 'output' && socket.side === 'input'\r\n  const backward = initial.side === 'input' && socket.side === 'output'\r\n  const [source, target] = forward\r\n    ? [initial, socket]\r\n    : backward\r\n      ? [socket, initial]\r\n      : []\r\n\r\n  if (source && target) return [source, target]\r\n}\r\n\r\nexport function canMakeConnection(initial: SocketData, socket: SocketData) {\r\n  return Boolean(getSourceTarget(initial, socket))\r\n}\r\n\r\nexport function makeConnection<Schemes extends ClassicScheme, K extends any[]>(initial: SocketData, socket: SocketData, context: Context<Schemes, K>) {\r\n  const [source, target] = getSourceTarget(initial, socket) || [null, null]\r\n\r\n  if (source && target) {\r\n    void context.editor.addConnection({\r\n      id: getUID(),\r\n      source: source.nodeId,\r\n      sourceOutput: source.key,\r\n      target: target.nodeId,\r\n      targetInput: target.key\r\n    })\r\n    return true\r\n  }\r\n}\r\n","/* eslint-disable @typescript-eslint/require-await */\r\nimport { ClassicScheme, SocketData } from '../../types'\r\nimport { Context, Flow, PickParams } from '../base'\r\nimport { makeConnection as defaultMakeConnection, State, StateContext } from '../utils'\r\n\r\n/**\r\n * Bidirect flow params\r\n */\r\nexport type BidirectParams<Schemes extends ClassicScheme> = {\r\n  /** If true, user can pick a pseudo-connection by clicking on socket, not only by pointerdown */\r\n  pickByClick: boolean\r\n  /** Custom function to make connection */\r\n  makeConnection: <K extends any[]>(from: SocketData, to: SocketData, context: Context<Schemes, K>) => boolean | undefined\r\n}\r\n\r\nclass Picked<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\r\n  constructor(public initial: SocketData, private params: BidirectParams<Schemes>) {\r\n    super()\r\n  }\r\n\r\n  async pick({ socket }: PickParams, context: Context<Schemes, K>): Promise<void> {\r\n    if (this.params.makeConnection(this.initial, socket, context)) {\r\n      this.drop(context, socket, true)\r\n    } else if (!this.params.pickByClick) {\r\n      this.drop(context, socket)\r\n    }\r\n  }\r\n\r\n  drop(context: Context<ClassicScheme, K>, socket: SocketData | null = null, created = false): void {\r\n    if (this.initial) {\r\n      void context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\r\n    }\r\n    this.context.switchTo(new Idle<Schemes, K>(this.params))\r\n  }\r\n}\r\n\r\nclass Idle<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\r\n  constructor(private params: BidirectParams<Schemes>) {\r\n    super()\r\n  }\r\n\r\n  async pick({ socket, event }: PickParams, context: Context<Schemes, K>): Promise<void> {\r\n    if (event === 'down') {\r\n      if (await context.scope.emit({ type: 'connectionpick', data: { socket } })) {\r\n        this.context.switchTo(new Picked(socket, this.params))\r\n      } else {\r\n        this.drop(context)\r\n      }\r\n    }\r\n  }\r\n\r\n  drop(context: Context<Schemes, K>, socket: SocketData | null = null, created = false): void {\r\n    if (this.initial) {\r\n      void context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\r\n    }\r\n    delete this.initial\r\n  }\r\n}\r\n\r\n/**\r\n * Bidirect flow. User can pick a socket and connect it by releasing mouse button.\r\n * More simple than classic flow, but less functional (can't remove connection by clicking on input socket).\r\n */\r\nexport class BidirectFlow<Schemes extends ClassicScheme, K extends any[]> implements StateContext<Schemes, K>, Flow<Schemes, K> {\r\n  currentState!: State<Schemes, K>\r\n\r\n  constructor(params?: Partial<BidirectParams<Schemes>>) {\r\n    const pickByClick = Boolean(params?.pickByClick)\r\n    const makeConnection = params?.makeConnection || defaultMakeConnection\r\n\r\n    this.switchTo(new Idle({ pickByClick, makeConnection }))\r\n  }\r\n\r\n  public async pick(params: PickParams, context: Context<Schemes, K>) {\r\n    await this.currentState.pick(params, context)\r\n  }\r\n\r\n  public getPickedSocket() {\r\n    return this.currentState.initial\r\n  }\r\n\r\n  public drop(context: Context<Schemes, K>) {\r\n    this.currentState.drop(context)\r\n  }\r\n\r\n  public switchTo(state: State<Schemes, K>): void {\r\n    state.setContext(this)\r\n    this.currentState = state\r\n  }\r\n}\r\n","import { NodeEditor } from 'rete'\r\n\r\nimport { ClassicScheme, SocketData } from '../../../types'\r\n\r\nfunction findPort<Schemes extends ClassicScheme>(socket: SocketData, editor: NodeEditor<Schemes>) {\r\n  const node = editor.getNode(socket.nodeId)\r\n\r\n  if (!node) throw new Error('cannot find node')\r\n\r\n  const list = socket.side === 'input'\r\n    ? node.inputs\r\n    : node.outputs\r\n\r\n  return list[socket.key]\r\n}\r\nfunction findConnections<Schemes extends ClassicScheme>(socket: SocketData, editor: NodeEditor<Schemes>) {\r\n  const { nodeId, side, key } = socket\r\n\r\n  return editor.getConnections().filter(connection => {\r\n    if (side === 'input') {\r\n      return connection.target === nodeId && connection.targetInput === key\r\n    }\r\n    if (side === 'output') {\r\n      return connection.source === nodeId && connection.sourceOutput === key\r\n    }\r\n  })\r\n}\r\n\r\n/**\r\n * Remove existing connections if Port doesnt allow multiple connections\r\n */\r\nexport function syncConnections<Schemes extends ClassicScheme>(sockets: SocketData[], editor: NodeEditor<Schemes>) {\r\n  const connections: Schemes['Connection'][] = sockets.map(socket => {\r\n    const port = findPort(socket, editor)\r\n    const multiple = port?.multipleConnections\r\n\r\n    if (multiple) return []\r\n\r\n    return findConnections(socket, editor)\r\n  }).flat()\r\n\r\n  return {\r\n    commit() {\r\n      const uniqueIds = Array.from(new Set(connections.map(({ id }) => id)))\r\n\r\n      uniqueIds.forEach(id => void editor.removeConnection(id))\r\n    }\r\n  }\r\n}\r\n","/* eslint-disable @typescript-eslint/require-await */\r\n\r\nimport { ClassicScheme, SocketData } from '../../../types'\r\nimport { Context, Flow, PickParams } from '../../base'\r\nimport {\r\n  canMakeConnection as defaultCanMakeConnection, makeConnection as defaultMakeConnection, State, StateContext\r\n} from '../../utils'\r\nimport { syncConnections } from './sync-connections'\r\n\r\n/**\r\n * Classic flow params\r\n */\r\nexport type ClassicParams<Schemes extends ClassicScheme> = {\r\n  /** Custom function to check if connection can be made */\r\n  canMakeConnection: (from: SocketData, to: SocketData) => boolean | undefined\r\n  /** Custom function to make connection */\r\n  makeConnection: <K extends any[]>(from: SocketData, to: SocketData, context: Context<Schemes, K>) => boolean | undefined\r\n}\r\n\r\nclass Picked<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\r\n  constructor(public initial: SocketData, private params: ClassicParams<Schemes>) {\r\n    super()\r\n  }\r\n\r\n  async pick({ socket }: PickParams, context: Context<Schemes, K>): Promise<void> {\r\n    if (this.params.canMakeConnection(this.initial, socket)) {\r\n      syncConnections([this.initial, socket], context.editor).commit()\r\n      const created = this.params.makeConnection(this.initial, socket, context)\r\n\r\n      this.drop(context, created\r\n        ? socket\r\n        : null, created)\r\n    }\r\n  }\r\n\r\n  drop(context: Context<Schemes, K>, socket: SocketData | null = null, created = false): void {\r\n    if (this.initial) {\r\n      void context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\r\n    }\r\n    this.context.switchTo(new Idle(this.params))\r\n  }\r\n}\r\n\r\nclass PickedExisting<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\r\n  initial!: SocketData\r\n  outputSocket: SocketData\r\n\r\n  constructor(public connection: Schemes['Connection'], private params: ClassicParams<Schemes>, context: Context<Schemes, K>) {\r\n    super()\r\n    const outputSocket = Array.from(context.socketsCache.values()).find(data => {\r\n      return data.nodeId === this.connection.source\r\n        && data.side === 'output'\r\n        && data.key === this.connection.sourceOutput\r\n    })\r\n\r\n    if (!outputSocket) throw new Error('cannot find output socket')\r\n\r\n    this.outputSocket = outputSocket\r\n  }\r\n\r\n  async init(context: Context<Schemes, K>) {\r\n    void context.scope.emit({ type: 'connectionpick', data: { socket: this.outputSocket } }).then(response => {\r\n      if (response) {\r\n        void context.editor.removeConnection(this.connection.id)\r\n        this.initial = this.outputSocket\r\n      } else {\r\n        this.drop(context)\r\n      }\r\n    })\r\n  }\r\n\r\n  async pick({ socket, event }: PickParams, context: Context<Schemes, K>): Promise<void> {\r\n    if (this.initial && !(socket.side === 'input' && this.connection.target === socket.nodeId && this.connection.targetInput === socket.key)) {\r\n      if (this.params.canMakeConnection(this.initial, socket)) {\r\n        syncConnections([this.initial, socket], context.editor).commit()\r\n        const created = this.params.makeConnection(this.initial, socket, context)\r\n        const droppedSocket = created\r\n          ? socket\r\n          : null\r\n\r\n        this.drop(context, droppedSocket, created)\r\n      }\r\n    } else if (event === 'down') {\r\n      if (this.initial) {\r\n        syncConnections([this.initial, socket], context.editor).commit()\r\n        const created = this.params.makeConnection(this.initial, socket, context)\r\n        const droppedSocket = created\r\n          ? null\r\n          : socket\r\n\r\n        this.drop(context, droppedSocket, created)\r\n      }\r\n    }\r\n  }\r\n\r\n  drop(context: Context<Schemes, K>, socket: SocketData | null = null, created = false): void {\r\n    if (this.initial) {\r\n      void context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\r\n    }\r\n    this.context.switchTo(new Idle<Schemes, K>(this.params))\r\n  }\r\n}\r\n\r\nclass Idle<Schemes extends ClassicScheme, K extends any[]> extends State<Schemes, K> {\r\n  constructor(private params: ClassicParams<Schemes>) {\r\n    super()\r\n  }\r\n\r\n  async pick({ socket, event }: PickParams, context: Context<Schemes, K>): Promise<void> {\r\n    if (event !== 'down') return\r\n    if (socket.side === 'input') {\r\n      const connection = context\r\n        .editor.getConnections()\r\n        .find(item => item.target === socket.nodeId && item.targetInput === socket.key)\r\n\r\n      if (connection) {\r\n        const state = new PickedExisting(connection, this.params, context)\r\n\r\n        await state.init(context)\r\n        this.context.switchTo(state)\r\n        return\r\n      }\r\n    }\r\n\r\n    if (await context.scope.emit({ type: 'connectionpick', data: { socket } })) {\r\n      this.context.switchTo(new Picked(socket, this.params))\r\n    } else {\r\n      this.drop(context)\r\n    }\r\n  }\r\n\r\n  drop(context: Context<Schemes, K>, socket: SocketData | null = null, created = false): void {\r\n    if (this.initial) {\r\n      void context.scope.emit({ type: 'connectiondrop', data: { initial: this.initial, socket, created } })\r\n    }\r\n    delete this.initial\r\n  }\r\n}\r\n\r\n/**\r\n * Classic flow. User can pick/click a socket and connect it by releasing/clicking on another socket.\r\n * If connection already exists and user clicks on input socket, connection will be removed.\r\n */\r\nexport class ClassicFlow<Schemes extends ClassicScheme, K extends any[]> implements StateContext<Schemes, K>, Flow<Schemes, K> {\r\n  currentState!: State<Schemes, K>\r\n\r\n  constructor(params?: Partial<ClassicParams<Schemes>>) {\r\n    const canMakeConnection = params?.canMakeConnection || defaultCanMakeConnection\r\n    const makeConnection = params?.makeConnection || defaultMakeConnection\r\n\r\n    this.switchTo(new Idle<Schemes, K>({ canMakeConnection, makeConnection }))\r\n  }\r\n\r\n  public async pick(params: PickParams, context: Context<Schemes, K>) {\r\n    await this.currentState.pick(params, context)\r\n  }\r\n\r\n  public getPickedSocket() {\r\n    return this.currentState.initial\r\n  }\r\n\r\n  public switchTo(state: State<Schemes, K>): void {\r\n    state.setContext(this)\r\n    this.currentState = state\r\n  }\r\n\r\n  public drop(context: Context<Schemes, K>) {\r\n    this.currentState.drop(context)\r\n  }\r\n}\r\n","import { ClassicFlow } from '../flow'\r\n\r\n/**\r\n * Classic preset. Uses `ClassicFlow` for managing connections by user\r\n */\r\nexport function setup() {\r\n  return () => new ClassicFlow()\r\n}\r\n","import { NodeEditor, Scope } from 'rete'\r\nimport { BaseArea, BaseAreaPlugin, RenderSignal } from 'rete-area-plugin'\r\n\r\nimport { Flow } from './flow'\r\nimport { EventType } from './flow/base'\r\nimport { createPseudoconnection } from './pseudoconnection'\r\nimport { ClassicScheme, Connection, Position, Preset, Side, SocketData } from './types'\r\nimport { elementsFromPoint, findSocket } from './utils'\r\n\r\nexport * from './flow'\r\nexport * as Presets from './presets'\r\nexport { createPseudoconnection } from './pseudoconnection'\r\nexport type { Connection, ConnectionExtra, Preset, Side, SocketData } from './types'\r\n\r\ntype Requires =\r\n  | { type: 'pointermove', data: { position: Position, event: PointerEvent } }\r\n  | { type: 'pointerup', data: { position: Position, event: PointerEvent } }\r\n  | RenderSignal<'socket', {\r\n    nodeId: string\r\n    side: Side\r\n    key: string\r\n  }>\r\n  | { type: 'unmount', data: { element: HTMLElement } }\r\n\r\n/**\r\n * Connection plugin. Responsible for user interaction with connections (creation, deletion)\r\n * @priority 9\r\n * @emits connectionpick\r\n * @emits connectiondrop\r\n * @listens pointermove\r\n * @listens pointerup\r\n * @listens render\r\n * @listens unmount\r\n */\r\nexport class ConnectionPlugin<Schemes extends ClassicScheme, K = Requires> extends Scope<Connection, [Requires | K]> {\r\n  presets: Preset<Schemes>[] = []\r\n  private areaPlugin!: BaseAreaPlugin<Schemes, BaseArea<Schemes>>\r\n  private editor!: NodeEditor<Schemes>\r\n  private currentFlow: Flow<Schemes, any[]> | null = null\r\n  private preudoconnection = createPseudoconnection({ isPseudo: true })\r\n  private socketsCache = new Map<Element, SocketData>()\r\n\r\n  constructor() {\r\n    super('connection')\r\n  }\r\n\r\n  /**\r\n   * Add preset to the plugin\r\n   * @param preset Preset to add\r\n   */\r\n  public addPreset(preset: Preset<Schemes>) {\r\n    this.presets.push(preset)\r\n  }\r\n\r\n  private findPreset(data: SocketData) {\r\n    for (const preset of this.presets) {\r\n      const flow = preset(data)\r\n\r\n      if (flow) return flow\r\n    }\r\n    return null\r\n  }\r\n\r\n  update() {\r\n    if (!this.currentFlow) return\r\n    const socket = this.currentFlow.getPickedSocket()\r\n\r\n    if (socket) {\r\n      this.preudoconnection.render(this.areaPlugin, this.areaPlugin.area.pointer, socket)\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Drop pseudo-connection if exists\r\n   * @emits connectiondrop\r\n   */\r\n  drop() {\r\n    const flowContext = { editor: this.editor, scope: this, socketsCache: this.socketsCache }\r\n\r\n    if (this.currentFlow) {\r\n      this.currentFlow.drop(flowContext)\r\n      this.preudoconnection.unmount(this.areaPlugin)\r\n      this.currentFlow = null\r\n    }\r\n  }\r\n\r\n  // eslint-disable-next-line max-statements\r\n  async pick(event: PointerEvent, type: EventType) {\r\n    const flowContext = { editor: this.editor, scope: this, socketsCache: this.socketsCache }\r\n    const pointedElements = elementsFromPoint(event.clientX, event.clientY)\r\n    const pickedSocket = findSocket(this.socketsCache, pointedElements)\r\n\r\n    if (pickedSocket) {\r\n      event.preventDefault()\r\n      event.stopPropagation()\r\n      this.currentFlow = this.currentFlow || this.findPreset(pickedSocket)\r\n\r\n      if (this.currentFlow) {\r\n        await this.currentFlow.pick({ socket: pickedSocket, event: type }, flowContext)\r\n        this.preudoconnection.mount(this.areaPlugin)\r\n      }\r\n    } else if (this.currentFlow) {\r\n      this.currentFlow.drop(flowContext)\r\n    }\r\n    if (this.currentFlow && !this.currentFlow.getPickedSocket()) {\r\n      this.preudoconnection.unmount(this.areaPlugin)\r\n      this.currentFlow = null\r\n    }\r\n    this.update()\r\n  }\r\n\r\n  setParent(scope: Scope<Requires | K>): void {\r\n    super.setParent(scope)\r\n    this.areaPlugin = this.parentScope<BaseAreaPlugin<Schemes, BaseArea<Schemes>>>(BaseAreaPlugin)\r\n    this.editor = this.areaPlugin.parentScope<NodeEditor<Schemes>>(NodeEditor)\r\n\r\n    const pointerdownSocket = (e: PointerEvent) => {\r\n      void this.pick(e, 'down')\r\n    }\r\n\r\n    this.addPipe(context => {\r\n      if (!context || typeof context !== 'object' || !('type' in context)) return context\r\n\r\n      if (context.type === 'pointermove') {\r\n        this.update()\r\n      } else if (context.type === 'pointerup') {\r\n        void this.pick(context.data.event, 'up')\r\n      } else if (context.type === 'render') {\r\n        if (context.data.type === 'socket') {\r\n          const { element } = context.data\r\n\r\n          element.addEventListener('pointerdown', pointerdownSocket)\r\n          this.socketsCache.set(element, context.data)\r\n        }\r\n      } else if (context.type === 'unmount') {\r\n        const { element } = context.data\r\n\r\n        element.removeEventListener('pointerdown', pointerdownSocket)\r\n        this.socketsCache.delete(element)\r\n      }\r\n      return context\r\n    })\r\n  }\r\n}\r\n"],"names":["createPseudoconnection","extra","element","id","unmount","areaPlugin","removeConnectionView","isMounted","Boolean","mount","concat","getUID","render","_ref","data","x","y","isOutput","side","pointer","Error","payload","_objectSpread","source","nodeId","sourceOutput","key","target","targetInput","view","addConnectionView","emit","type","end","start","findSocket","socketsCache","elements","_step","_iterator","_createForOfIteratorHelper","s","n","done","value","found","get","err","e","f","elementsFromPoint","_elements$","root","arguments","length","undefined","document","shadowRoot","unshift","apply","_toConsumableArray","Flow","_createClass","_classCallCheck","State","context","this","getSourceTarget","initial","socket","forward","backward","_ref2","_slicedToArray","canMakeConnection","makeConnection","_ref4","editor","addConnection","Picked","_State","params","_this","_callSuper","_inherits","_pick","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_context","prev","next","drop","pickByClick","stop","_x","_x2","created","scope","switchTo","Idle","_State2","_this2","_pick2","_callee2","_context2","event","sent","_x3","_x4","BidirectFlow","defaultMakeConnection","_pick3","_callee3","_context3","currentState","pick","_x5","_x6","state","setContext","syncConnections","sockets","connections","map","port","node","getNode","inputs","outputs","findPort","multipleConnections","getConnections","filter","connection","findConnections","flat","commit","Array","from","Set","forEach","removeConnection","PickedExisting","outputSocket","values","find","_init","_this3","then","response","droppedSocket","_created","_droppedSocket","_State3","_this4","_callee4","_ref3","_connection","_context4","abrupt","item","init","_x7","ClassicFlow","defaultCanMakeConnection","_pick4","_callee5","_context5","_x8","_x9","ConnectionPlugin","_Scope","_defineProperty","isPseudo","Map","preset","presets","push","flow","currentFlow","getPickedSocket","preudoconnection","area","flowContext","pointedElements","pickedSocket","clientX","clientY","preventDefault","stopPropagation","findPreset","update","parentScope","BaseAreaPlugin","NodeEditor","pointerdownSocket","addPipe","_typeof","addEventListener","set","removeEventListener","Scope"],"mappings":"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"}